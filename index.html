<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	<meta charset="UTF-8" />
    <title>Projeto G</title>

	<!--[if IE]><script type="text/javascript" src="lib/excanvas.js"></script><![endif]-->
    <script type="text/javascript" src="lib/prototype-1.7.1.0.js"></script>
    <script type="text/javascript" src="lib/Box2dWeb-2.1.a.3.min.js"></script>
	<script type="text/javascript" src="lib/jquery-2.0.2.min.js"></script>
	<!--<script type="text/javascript" src="lib/jquery-ui-1.10.3.custom.min.js"></script>-->
                    
    <script type="text/javascript" src='js/game/player.js'></script>
    <script type="text/javascript" src='js/game/ground.js'></script>
    <script type="text/javascript" src='js/game/game.js'></script>

  </head>
<body>
    <script type="text/javascript">

		var $j = jQuery.noConflict();

        var b2Vec2 = Box2D.Common.Math.b2Vec2
          , b2AABB = Box2D.Collision.b2AABB
          , b2BodyDef = Box2D.Dynamics.b2BodyDef
          , b2Body = Box2D.Dynamics.b2Body
          , b2FixtureDef = Box2D.Dynamics.b2FixtureDef
          , b2Fixture = Box2D.Dynamics.b2Fixture
          , b2World = Box2D.Dynamics.b2World
          , b2MassData = Box2D.Collision.Shapes.b2MassData
          , b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape
          , b2CircleShape = Box2D.Collision.Shapes.b2CircleShape
          , b2DebugDraw = Box2D.Dynamics.b2DebugDraw
          , b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef
        ;

        var ctx;
        var canvasElm;
        var canvasWidth;
        var canvasHeight ;
        var canvasTop;
        var canvasLeft;
        var currentPlayer;

		var game;
        
        Event.observe(window, 'keydown', function (e) {
            if (currentPlayer)
                currentPlayer.move(e.keyIdentifier);
        });

		var mousestate = { x: 0, y: 0, pressed: false };

		Event.observe(window, 'mousedown', function (e) { mousestate.pressed = true; mousestate.x = e.offsetX; mousestate.y = e.offsetY; })
		Event.observe(window, 'mouseup', function (e) { mousestate.pressed = false; })
		Event.observe(window, 'mousemove', function (e) { 
			if (mousestate.pressed) {
				game.offsetX -= mousestate.x - e.offsetX;
				game.offsetY -= mousestate.y - e.offsetY;
				mousestate.x = e.offsetX;
				mousestate.y = e.offsetY;
				//ctx.fillRect(game.offsetX, game.offsetY, canvasWidth + game.offsetX, canvasHeight+game.offsetY);
				ctx.translate(game.offsetX, game.offsetY);
			} 
		})

        Event.observe(window, 'load', function () {           
                        
            Event.observe('canvas', 'contextmenu', function (e) {
                if (e.preventDefault) e.preventDefault();
                return false;
            });

            ctx = $('canvas').getContext("2d");
            canvasElm = $('canvas');            
            canvasWidth = parseInt(canvasElm.width);
            canvasHeight = parseInt(canvasElm.height);
            canvasTop = parseInt(canvasElm.style.top);
            canvasLeft = parseInt(canvasElm.style.left);
           
            game = new Game(ctx, {});
            game.createGround();

            var p1 = new Player('Henry', (canvasWidth / 2), canvasTop);
            var p2 = new Player('Joao', 60, canvasTop);
            var p3 = new Player('Denilson', canvasWidth - 30, canvasTop);
            currentPlayer = p1;

			game.setInterest(p1);

			game.createPlayer(p1);
			game.createPlayer(p2);
			game.createPlayer(p3);
            
			game.debugDraw();           
            
			game.start();        
			
			ctx.translate(0, 0);   
        });
    </script>

    <canvas id="canvas" width='1000' height='400' style="top:0px; left:0px; background-color:#333333;">
    </canvas>

</body>
</html>
